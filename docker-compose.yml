version: '3.8'

services:
  app:
    build: .
    container_name: azure-password-notifier
    ports:
      # HOST_PORT:CONTAINER_PORT
      # This maps localhost:8085 to the container's internal port 3000
      - "${WEB_PORT:-8085}:3000"
    environment:
      - NODE_ENV=production
      # Optional: Pre-seed credentials (safest to use .env file)
      - AZURE_TENANT_ID=${AZURE_TENANT_ID}
      - AZURE_CLIENT_ID=${AZURE_CLIENT_ID}
      - AZURE_CLIENT_SECRET=${AZURE_CLIENT_SECRET}
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_PORT=${SMTP_PORT}
      - SMTP_USERNAME=${SMTP_USERNAME}
      - SMTP_PASSWORD=${SMTP_PASSWORD}
    volumes:
      # Persist the configuration JSON so settings aren't lost on restart
      - ./config:/app/config
    restart: unless-stopped